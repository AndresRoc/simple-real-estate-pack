function srp_check_prefilled(){jQuery('input[id$="price_of_home"]').each(function(e){if(""!=jQuery(this).val()){var r=jQuery(this).attr("id"),t=r.replace(/\D/g,"");srp_MortgageCalc_calculate(t)}}),jQuery('input[id$="loan_amount"]').each(function(e){if(""!=jQuery(this).val()){var r=jQuery(this).attr("id"),t=r.replace(/\D/g,"");srp_ClosingCosts_calculate(t)}})}function showClosingDetails(e){jQuery("#"+e).is(":hidden")?jQuery("#"+e).slideDown("slow"):jQuery("#"+e).slideUp("slow")}function srp_removeThickBoxEvents(){jQuery(".thickbox").each(function(e){jQuery(this).unbind("click")})}function srp_bindThickBoxEvents(){srp_removeThickBoxEvents(),tb_init("a.thickbox, area.thickbox, input.thickbox")}function srp_MortgageCalc_calculate(e){jQuery("#srp_mortgagecalc-"+e+" div.additional-info").hide();var r=jQuery("input#widget-srp_mortgagecalc-"+e+"-price_of_home").asNumber(),t=jQuery("input#widget-srp_mortgagecalc-"+e+"-down_payment").asNumber(),i=jQuery("input#widget-srp_mortgagecalc-"+e+"-mortgage_term").asNumber(),a=jQuery("input#widget-srp_mortgagecalc-"+e+"-interest_rate").asNumber();if(100==t||t>100)return alert("Down Payment can not be equal of larger than the price of home."),jQuery("input#widget-srp_mortgagecalc-"+e+"-down_payment").val(""),srp_MortgageCalc_calculate(e),!1;if(jQuery("input#widget-srp_mortgagecalc-"+e+"-price_of_home").removeClass("highlight"),!r){jQuery("input#widget-srp_mortgagecalc-"+e+"-price_of_home").addClass("highlight");var s=!0}if(!i||0==i){jQuery("input#widget-srp_mortgagecalc-"+e+"-mortgage_term").addClass("highlight");var s=!0}if(!a||0==a){jQuery("input#widget-srp_mortgagecalc-"+e+"-interest_rate").addClass("highlight");var s=!0}if(s&&alert("Please fill out the highlighted fields."),!s){var n=a/100,o=Math.round(r*t/100*100)/100,l=n/12,u=12*i,c=Math.round(100*(r-o))/100,p=1+l,d=u*-1,_=1-Math.pow(p,d),g=Math.round(c*(l/_)*100)/100,m=0,y="",f=jQuery("input#property_tax_rate").asNumber(),h=jQuery("input#home_insurance_rate").asNumber(),v=jQuery("input#pmi").asNumber(),j=Math.round(r*f/100/12*100)/100,Q=Math.round(r*h/100/12*100)/100;if(t<20)var b=Math.round(r*v/100/12*100)/100;else var b=0;m=j+Q+b,y="<div>Principal & Interest:\t\t"+srp_cl(g)+"</div><div>Mo. Tax:\t\t\t\t"+srp_cl(j)+"</div><div>Mo. Home Insurance:\t"+srp_cl(Q)+"</div><div>Mo. PMI:\t\t\t\t"+srp_cl(b)+"</div>";var w={form_complete:1,sale_price:r,down_percent:t,year_term:i,annual_interest_percent:a,show_progress:1},x=jQuery('<a href="#" title="Mortgage Amortization Schedule">Amortization Schedule</a>').css("cursor","pointer").data(w).on("click",function(e){e.preventDefault(),e.stopPropagation();var r={action:"srp_getAmortizationSchedule",params:jQuery(this).data()};jQuery.post(srp.ajaxurl,r,function(e){e&&(jQuery("#srp-dialog-content").html(e),setTimeout(function(){tb_show("Mortgage Amortization Schedule","#TB_inline?&height=500&width=650&inlineId=srp-dialog-content",null)},50))})}),M=y+"<div>Down Payment:\t\t"+srp_cl(o)+"</div><div class='srp_tb srp_bb'>Financed Amount:\t"+srp_cl(c)+"</div><div class='srp_result_link'></div>",N=jQuery(document.createDocumentFragment());N=N.append(M),N.find(".srp_result_link").append(x),jQuery("input#widget-srp_mortgagecalc-"+e+"-monthly_payment").val(Math.round(100*(g+m))/100).formatCurrency({symbol:""}),jQuery("input#widget-srp_mortgagecalc-"+e+"-monthly_payment").addClass("total"),jQuery("#widget-srp_mortgagecalc-"+e+"-result").html(N).slideDown("slow").show()}}function srp_Affordability_calculate(e){var r=jQuery("input#widget-srp_affordabilitycalc-"+e+"-mo_gross_income").asNumber(),t=jQuery("input#widget-srp_affordabilitycalc-"+e+"-mo_debt_expences").asNumber(),i=jQuery("input#widget-srp_affordabilitycalc-"+e+"-down_payment").asNumber(),a=jQuery("input#widget-srp_affordabilitycalc-"+e+"-interest_rate").asNumber(),s=jQuery("input#widget-srp_affordabilitycalc-"+e+"-property_tax").asNumber(),n=jQuery("input#widget-srp_affordabilitycalc-"+e+"-home_insurance").asNumber(),o=jQuery("input#widget-srp_affordabilitycalc-"+e+"-pmi").asNumber(),l=.28*r,u=.36*r-t;l<u?smaller=Math.round(l):smaller=Math.round(u);var c=a/100/12,p=360,d=-p,_=Math.pow(1+c,d),g=c/(1-_),m=(n+s+o)/100/12,y=smaller/(g+m);i>0&&(y=(smaller-i*m)/(g+m));var f="Tax, insurance & PMI",h=100*i/(y+i);if(h>=20){o=0,m=(n+s+o)/100/12,y=Math.round((smaller-i*m)/(g+m)),h=100*i/(y+i);var f="Tax and insurance"}var v=Math.round(y+i),j=Math.round((n+s+o)*v/100/12),Q="";if(i>0)var Q='<div>Downpayment: <span class="srp_amnt">'+Math.round(100*h)/100+"%</span></div><div>Loan Amount: "+srp_cl(Math.round(y))+"</div>";var b={type:"affordability",mo_gross_income:r,mo_debt_expences:t,down_payment:i,interest_rate:a},w=jQuery('<a href="#" title="Home Mortgage Affordability">View Calculation Details</a>').css("cursor","pointer").data(b).on("click",function(e){e.preventDefault(),e.stopPropagation();var r={action:"srp_getAffordabilityDetails",params:jQuery(this).data()};jQuery.post(srp.ajaxurl,r,function(e){e&&(jQuery("#srp-dialog-content").html(e),setTimeout(function(){tb_show("Home Mortgage Affordability","#TB_inline?&height=700&width=600&inlineId=srp-dialog-content",null)},50))})}),x={shouldAfford:function(){return v<1?0:v},pmi:function(){return v<1?0:smaller-j},deductions:function(){return v<1?0:j},smaller:function(){return v<1?0:smaller},link:function(){return v<1?"":w}},M='<div class="srp_bb">You Should Afford: '+srp_cl(x.shouldAfford())+"</div>"+Q+"<div>Principal & Interest: "+srp_cl(x.pmi())+"</div><div>"+f+": "+srp_cl(x.deductions())+' </div><div class="srp_tb srp_bb">Total Payments (mo): '+srp_cl(x.smaller())+'</div><div class="srp_result_link"></div>',N=jQuery(document.createDocumentFragment()),k=N.append(M);k.find(".srp_result_link").append(x.link()),r>0&&t>=0&&a>0&&jQuery("#widget-srp_affordabilitycalc-"+e+"-result").html(k).slideDown("slow").addClass("total")}function srp_ClosingCosts_calculate(e){var r=jQuery("input#widget-srp_closingcosts-"+e+"-loan_amount").asNumber(),t=jQuery("input#widget-srp_closingcosts-"+e+"-discount_points").asNumber(),i=jQuery("input#widget-srp_closingcosts-"+e+"-origination_fee").asNumber(),a=jQuery("input#widget-srp_closingcosts-"+e+"-lender_fees").asNumber(),s=jQuery("input#widget-srp_closingcosts-"+e+"-credit_report_fee").asNumber(),n=jQuery("input#widget-srp_closingcosts-"+e+"-appraisal").asNumber(),o=jQuery("input#widget-srp_closingcosts-"+e+"-title_insurance").asNumber(),l=jQuery("input#widget-srp_closingcosts-"+e+"-reconveyance_fee").asNumber(),u=jQuery("input#widget-srp_closingcosts-"+e+"-recording_fee").asNumber(),c=jQuery("input#widget-srp_closingcosts-"+e+"-wire_courier_fee").asNumber(),p=jQuery("input#widget-srp_closingcosts-"+e+"-endorsement_fee").asNumber(),d=jQuery("input#widget-srp_closingcosts-"+e+"-title_closing_fee").asNumber(),_=jQuery("input#widget-srp_closingcosts-"+e+"-title_doc_prep_fee").asNumber(),g=jQuery("input#widget-srp_closingcosts-"+e+"-other_fees").asNumber();if(t>0)var m=t/100*r;else var m=0;if(i>0)var y=i/100*r;else var y=0;var f=m+y+a+s+n+o+l+u+c+p+d+_+g,h="<strong>Total Closing Cost: "+srp_cl(f)+"</strong>";r>1e3&&f>0&&jQuery("#widget-srp_closingcosts-"+e+"-result").html(h).slideDown("slow").addClass("total")}function srp_cl(e){e+="",x=e.split("."),x1=x[0],x2=x.length>1?"."+x[1]:"";for(var r=/(\d+)(\d{3})/;r.test(x1);)x1=x1.replace(r,"$1,$2");return'<span class="srp_amnt">$'+(x1+x2)+"</span>"}jQuery(document).ready(function(){jQuery(".srp-tabs").css({display:"block"}),jQuery('input[id^="widget-srp_mortgagecalc-"]').live("keyup",function(){var e=jQuery(this).attr("id"),r=e.replace(/\D/g,""),t=jQuery("input#widget-srp_mortgagecalc-"+r+"-price_of_home").asNumber();t>0&&srp_MortgageCalc_calculate(r)}),jQuery('input[id^="widget-srp_affordabilitycalc-"]').live("keyup",function(e){var r=jQuery(this).attr("id"),t=r.replace(/\D/g,"");srp_Affordability_calculate(t)}),jQuery('input[id$="price_of_home"]').live("blur",function(){jQuery(this).formatCurrency({dropDecimals:!0,symbol:""})}),jQuery("a#srp_help").live("click",function(){jQuery("#srp_help_text > div.additional-info").css({background:"#F3F6FB",border:"1px solid #D2DFFF",padding:"5px"}).toggle("slow")}),jQuery('input[id^="widget-srp_closingcosts-"]').live("keyup",function(e){var r=jQuery(this).attr("id"),t=r.replace(/\D/g,"");srp_ClosingCosts_calculate(t)}),jQuery('<div id="srp-dialog"><div id="srp-dialog-content"></div></div>').appendTo("body"),srp_check_prefilled()});